#!/usr/bin/env node
"use strict";

const path = require("path");
const program = require("commander");

const pkg = require("../package.json");

/**
 * Parse the path pass to it's absolute form
 *
 * @param {string} element - The path
 * @return {string}
 */
function parsePath(element) {
    if (element) {
        if (path.isAbsolute(element)) {
            return element;
        } else {
            return path.join(process.cwd(), element);
        }
    } else {
        return process.cwd();
    }
}

program
    .version(pkg.version, "-v, --version")
    .option("-p --pack [path]", "Create a .upack package. Default: Current working directory.", parsePath, null)
    .option("-o --outputDirectory [path]", "Specifies the directory for the created package file. If not specified, --pack output to the current directory.", parsePath, null)
    .option("-P --push [path]", "Publish the package. Require: --source", parsePath, null)
    .option("-d --deploy [path]", "Create the package and publish it on the server.", parsePath, null)
    .option("-s --source [source]", "The address of the server to deploy to.", undefined, null)
    .option("-V --Version [version]", "Set the package to the specified version.", undefined, null)
    .option("-f --force", "For --pack, can overwrite the package.", null, null)
    .option("-F --Feed [feed]", "Set the feed to the specified feed.", null, null)
    .parse(process.argv);

require("../lib/main")(program);